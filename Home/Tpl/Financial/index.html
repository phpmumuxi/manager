<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>财务管理|<{$configcache['Title']}></title>
  <link rel="stylesheet" type="text/css" href="__CSS__/content.css"  />
  <link rel="stylesheet" type="text/css" href="__CSS__/public.css"  />
  <script type="text/javascript" src="__JS__/jquery.js"></script>
  <script type="text/javascript" src="__JS__/Public.js"></script>
  <script type="text/javascript" src="__JS__/winpop.js"></script>
  <script type="text/javascript" src="__JS__/My97DatePicker/WdatePicker.js"></script>
  <script type="text/javascript" src="__JS__/layer/layer.js"></script>
  <link rel="stylesheet" type="text/css" href="__JS__/layer/skin/layer.css"  />
  <style type="text/css">
  .select{padding:5px 10px;border:#ddd 1px solid;border-radius:4px;width:60%;margin:5% auto;font-size:12px}
  .select li{list-style:none;padding:10px 0 5px 100px}
  .select .select-list{border-bottom:#eee 1px dashed}
  .select dl{zoom:1;position:relative;line-height:24px;}
  .select dl:after{content:" ";display:block;clear:both;height:0;overflow:hidden}
  .select dt{width:100px;margin-bottom:5px;position:absolute;top:0;left:-100px;text-align:right;color:#666;height:24px;line-height:24px}
  .select dd{float:left;display:inline;margin:0 0 5px 5px;}
  .select a{display:inline-block;white-space:nowrap;height:24px;padding:0 10px;text-decoration:none;color:#039;border-radius:2px;}
  .select a:hover{color:#f60;background-color:#f3edc2}
  .select .selected a{color:#fff;background-color:#f60}
  .select-result dt{font-weight:bold}
  .select-no{color:#999}
  .select .select-result a{padding-right:20px;background:#f60 url("__PUBLIC__/image/close.gif") right 9px no-repeat}
  .select .select-result a:hover{background-position:right -15px}
  .tc{text-align:center; text-indent:0;font-family:"微软雅黑";font-size: 14px;color:#111;}
  .tel{left:0; top:10px; width:220px; height:26px; line-height:26px; color:#555; font-family:"微软雅黑"; repeat-x left top; border:solid 1px #ccc;}
  .tel-1{left:220px; top:10px; width:60px; height:28px; line-height:28px; border:none; background:#090; color:#fff; font-family:"微软雅黑"; cursor:pointer;}
  #str{position:absolute; margin-left:400px;}
  </style>
</head>
<body>
  <div id="content">
   <h1>首页 > 财务管理 > 财务列表</h1>
   <h2>
     <div class="h2_left">
       <a href="__ACTION__" class="whole">全部</a>
       <a href="javascript:;" class="f5" onclick="f5();">刷新</a>
       <a href="javascript:history.back();" class="Retreat">后退</a>
       <a href="javascript:history.go(1);" class="Advance">前进</a>
     </div>
   </h2>
   <div class="fen">
    <ul class="select" style="height:190px;margin-top: 20px;margin-bottom: 20px;">
     <li class="select-list List_more"> 
      <dl id="select">
        <dt>交易类型：</dt>
        <dd <?php if(get('s')<0){ echo 'class="selected select-all"';} $s = -1;?>><a href="<{$s|createsearchurl="/Financial/index",s,###,"add",null,null}>">全部</a></dd>
        <volist name="tradeType" id="val">
          <dd <if condition="$Think.get.s eq $val['value']"> class="selected select-all"</if>><a href="<{$val.value|createsearchurl="/Financial/index",s,###,"add",null,null}>"><{$val.name}></a></dd>
        </volist>
      </dl>
    </li>
    <li class="select-list List_more"> 
      <dl id="select">
        <dt>交易状态：</dt>
        <dd <?php if(get('t')<0){ echo ' class="selected select-all"';}$t = -1;?>><a href="<{$t|createsearchurl="/Financial/index",t,###,"add",null,null}>">全部</a></dd>
        <volist name="tradeStatus" id="val">
          <dd <if condition="$Think.get.t eq $val['value']"> class="selected select-all"</if>><a href="<{$val.value|createsearchurl="/Financial/index",t,###,"add",null,null}>"><{$val.name}></a></dd>
        </volist>
      </dl>
    </li>
    <li class="select-list List_more"> 
      <dl id="select">
        <dt>支付类型：</dt>
        <dd <?php if(get('p')<0){ echo ' class="selected select-all"';}$p = -1;?>><a href="<{$p|createsearchurl="/Financial/index",p,###,"add",null,null}>">全部</a></dd>
        <volist name="payType" id="val">
          <dd <if condition="$Think.get.p eq $val['value']"> class="selected select-all"</if>><a href="<{$val.value|createsearchurl="/Financial/index",p,###,"add",null,null}>"><{$val.name}></a></dd>
        </volist>
      </dl>
    </li>

     <li class="select-list List_more"> 
      <dl id="select">
        <dt>是否返利：</dt>
        <dd <?php if(get('f')<0){ echo ' class="selected select-all"';}$f = -1;?>><a href="<{$f|createsearchurl="/Financial/index",f,###,"add",null,null}>">全部</a></dd>
          <dd <if condition="$Think.get.f eq '推荐返利'"> class="selected select-all"</if>><a href="<{$f='推荐返利'|createsearchurl="/Financial/index",f,###,"add",null,null}>">已返利</a></dd>
      </dl>
    </li>

  </ul>
</div>
<div>
  <form method="get">
    <table>
      <tr>
        <td><label for="txtname">电话：</label></td>
        <td class="tel"><input type="text" name="tel" class="tel" value="<{$tel}>"/></td>
        <td>&nbsp;&nbsp;</td>
        <td><label for="txtpswd">真实姓名:</label></td>
        <td class="tel"> <input type="text" name="userName" class="tel" value="<{$userName}>"/></td>
        <td>&nbsp;&nbsp;</td>
        <td><label for="txtpswd">订单号:</label></td>
        <td class="tel"><input type="text" name="orderNo" class="tel" value="<{$orderNo}>"/></td>
        <td>&nbsp;&nbsp;</td>
        <td>
          <input type="submit" class="tel-1" value="搜索"/>
        </td>
              <!--   <td>&nbsp;&nbsp;</td>
                <td>
                    <input type="reset" class="tel-1"/>
                  </td> -->
      </tr>
    </table>
  </form>
</div>
          <div id="str"></div>
          <table id="table" border="1" bordercolor="#CCCCCC" cellpadding="0" cellspacing="0">
           <tr>
             <th>用户昵称</th>
             <th>电话</th>
             <th>真实姓名</th>
             <th>金额</th>
             <th>交易开始时间</th>
             <th>交易结束时间</th>
             <th>订单号</th>
             <th>交易类型</th>
             <th>交易状态</th>
             <th>支付类型</th>
    
           </tr>
        <if condition="count($pay)">
           <volist name="pay" id="vo">
            <tr>
             <td style="text-align:center" class='tc'><span class="username" approveStatus="4" style="cursor:pointer" sid="<{$vo.sid}>"><{$vo.userNickName}></span></td>
             <td style="text-align:center" class='tc'><{$vo.userTelephone}></td>
             <td style="text-align:center" class='tc'><{$vo.userRealName}></td>
             <td style="text-align:center" class='tc'><{$vo.money}> 元</td>
             <td style="text-align:center" class='tc'><{$vo.tradeTime}></td>
             <td style="text-align:center" class='tc'><{$vo.tradeFinishTime}></td>
             <td style="text-align:center" class='tc'><{$vo.orderNo}></td>
             <td style="text-align:center" class='tc'>
              <!-- 使用switch标签判断输出 -->
              <switch name="vo.tradeType">
                <case value="0"><a href="javascript:;" class="cash" bankname ='<{$vo.bankname}>' cardNo='<{$vo.cardNo}>' style="color:#0000FF" mainTradeNo="<{$vo.mainTradeNo}>">提现</a></case>
                  <case value="1">逸管家自营服务</case>
                  <case value="2">在线收款</case>
                  <case value="3">在线支付</case>
                  <case value="4">在线退款</case>
                  <case value="5">充值</case>
                <default />
              </switch>
            </td>
            <td style="text-align:center" class='tc'>
             <!-- 使用switch标签判断输出 -->
             <switch name="vo.tradeStatus">
               <case value="0">失败</case>
               <case value="1">待付款</case>
               <case value="2">成功</case>
               <case value="3">待收款</case>
               <default />
             </switch>
           </td>
           <td style="text-align:center" class='tc'>
            <!-- 使用switch标签判断输出 -->
            <switch name="vo.payType">
              <case value="0">支付宝</case>
              <case value="1">微信</case>
              <case value="2">余额支付</case>
              <case value="3">银行卡</case>
              <case value="4">线下付款</case>
              <default />
            </switch>
          </td>

    </tr> 
  </volist>
    <else />
  <tr><td style="text-align:center" colspan="11" class='tc'>当前请求无数据</td></tr>
  </if>
  <p>
  </p>
</table>
<div id="page">
  <{$page}>
</div>
</div>
<script type="text/javascript">
$(function()
{
  $ ("select").change (function ()
  {
    var tradeStatus = ($ (this).find ("option:selected").attr ("tradeStatus"));
    if(tradeStatus == 40){
      tradeStatus = 0;
    }
    var id =  ($ (this).find ("option:selected").attr ("id"));
            //console.log(tradeStatus+id);
            $.ajax({
              type: "POST",
              cache: true,
              async: true,
              ifModified:true,
              timeout:12000,
              url: "<{$url}>/manager/wtRecord/editWtRecord",
              data: {tradeStatus:tradeStatus,id:id}, 
              dataType: "json",
              // accepts: "json",
              success: function(json) {
                f5();
              },  
              error: function(XMLHttpRequest, exception) {
                f5();
                // if (XMLHttpRequest.status == 0) {
                //   alert('网络不给力，请稍后再试！');
                // }else if (XMLHttpRequest.status == 404) {
                //   alert('资源地址不存在');
                // }else if (XMLHttpRequest.status == 408) {
                //   alert('网络不给力，请稍后再试！');
                // }else if (XMLHttpRequest.status == 500) {
                //   alert('服务器出错啦')
                // }else if (XMLHttpRequest.status == 502) {
                //   alert('Web服务器用作网关或代理服务器时收到了无效响应');
                // }else if (XMLHttpRequest.status == 503) {
                //   alert('服务不可用');
                // }else if (XMLHttpRequest.status == 504) {
                //   alert('网关超时！');
                // }else{
                // }
              }
            })
})
})
</script>

<script type="text/javascript">
$(function (){
  $('.success').click(function(){
    var tradeStatus = 2;
    var id= $(this).attr('id');
    //console.log(id+tradeStatus);
    if(!confirm("确认修改状态吗？")){ 
      window.event.returnValue = false; 
      return;
    } 
    $.ajax({
      type: "POST",
      cache: true,
      async: true,
      ifModified:true,
      timeout:12000,
      url: "<{$url}>/manager/wtRecord/editWtRecord",
      data: {tradeStatus:tradeStatus,id:id}, 
      dataType: "json",
      // accepts: "json",
      success: function(json) {
        f5();
      },  
      error: function(XMLHttpRequest, exception) {
        f5();
      }
    })
  });

  $('.nopass').click(function(){
    var tradeStatus = 0;
    var id= $(this).attr('id');
    // console.log(id+tradeStatus);
    if(!confirm("确认修改状态吗？")){ 
      window.event.returnValue = false; 
      return;
    } 
    $.ajax({
      type: "POST",
      cache: true,
      async: true,
      ifModified:true,
      timeout:12000,
      url: "<{$url}>/manager/wtRecord/editWtRecord",
      data: {tradeStatus:tradeStatus,id:id}, 
      dataType: "json",
      // accepts: "json",
      success: function(json) {
        f5();
      },  
      error: function(XMLHttpRequest, exception) {
        f5();
      }
    })
  });

  // $('.voucher').click(function(){
  //   var mainTradeNo= $(this).attr('mainTradeNo');
  //   //console.log(mainTradeNo);return;
  //   $.ajax({
  //     type: "POST",
  //     cache: true,
  //     async: true,
  //     ifModified:true,
  //     timeout:12000,
  //     url: "<{$url}>/manager/wtRecord/checkUpCertificate",
  //     data: {mainTradeNo:mainTradeNo}, 
  //     dataType: "json",
  //     success: function(data) {
  //         //console.log(data);
  //         if(data.code == '2000'){
  //           if(data.data){
  //             var tong = '<div id="tong" class="hide layui-layer-wrap" style="display:block;"><img src="'+data.data.certificateUrl+'" style="width:1200px;height:800px;"></div>';
  //             layer.open({
  //               type: 1,
  //               title: false,
  //               closeBtn: 1,
  //               area: '1202px',
  //                 skin: 'layui-layer-nobg', //没有背景色
  //                 shadeClose: true,
  //                 content: tong
  //               });
   
  //           }else{
  //             alert(data.message);
  //           }
  //         }
  //       },  
  //       error: function(XMLHttpRequest, exception) {
  //         f5();
  //       }
  //     })
  // });
});



$('.cash').click(function(){
  var bankname = $(this).attr('bankname');
  var cardNo = $(this).attr('cardNo');
  var bank =  '<br>开户银行:'+bankname+'<br><br>银行账号:'+cardNo+'';
  //console.log(bank);
  layer.open({
    type: 1,
      skin: 'layui-layer-rim', //加上边框
      area: ['420px', '240px'], //宽高
      content: bank
    });
});


$('.paysure').click(function(){
  var tradeStatus = '2';
  var id= $(this).attr('id');
  var orderNo = $(this).attr('orderNo');
  var userId = "<{$userId}>";
  //alert(userId);return;
  // if(userId == 12){
  //wintq('正在处理,请稍后...',4,20000,0,'');
    // console.log(orderNo);return;
    var index = layer.load(0, {shade: false});
    if(!confirm("确认修改状态吗？")){ 
      window.event.returnValue = false; 
      layer.closeAll('loading');
      return;
    } 
    $.ajax({
      type: "POST",
      cache: true,
      async: true,
      ifModified:true,
      timeout:12000,
      url: "<{$url}>/manager/wtRecord/confimOfflineWtRecord",
      data: {tradeStatus:tradeStatus,id:id,orderNo:orderNo}, 
      dataType: "json",
      // accepts: "json",
      success: function(data) {
        layer.closeAll('loading');
        alert('修改成功');
        f5();
      },  
      error: function(XMLHttpRequest, exception) {
        f5();
      }
    })
  // }else{
  //   alert('您没有操作权限!');
  //   return;
  // }
  });

</script>

</body>
</html>
