<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>财务管理|<{$configcache['Title']}></title>
    <link rel="stylesheet" type="text/css" href="__CSS__/content.css"  />
    <link rel="stylesheet" type="text/css" href="__CSS__/public.css"  />
    <script type="text/javascript" src="__JS__/jquery.js"></script>
    <script type="text/javascript" src="__JS__/Public.js"></script>
    <script type="text/javascript" src="__JS__/winpop.js"></script>
    <script type="text/javascript" src="__JS__/My97DatePicker/WdatePicker.js"></script>
    <script type="text/javascript" src="__JS__/layer/layer.js"></script>
    <link rel="stylesheet" type="text/css" href="__JS__/layer/skin/layer.css"  />
    <style type="text/css">
        .select{padding:5px 10px;border:#ddd 1px solid;border-radius:4px;width:60%;margin:5% auto;font-size:12px}
        .select li{list-style:none;padding:10px 0 5px 100px}
        .select .select-list{border-bottom:#eee 1px dashed}
        .select dl{zoom:1;position:relative;line-height:24px;}
        .select dl:after{content:" ";display:block;clear:both;height:0;overflow:hidden}
        .select dt{width:100px;margin-bottom:5px;position:absolute;top:0;left:-100px;text-align:right;color:#666;height:24px;line-height:24px}
        .select dd{float:left;display:inline;margin:0 0 5px 5px;}
        .select a{display:inline-block;white-space:nowrap;height:24px;padding:0 10px;text-decoration:none;color:#039;border-radius:2px;}
        .select a:hover{color:#f60;background-color:#f3edc2}
        .select .selected a{color:#fff;background-color:#f60}
        .select-result dt{font-weight:bold}
        .select-no{color:#999}
        .select .select-result a{padding-right:20px;background:#f60 url("__PUBLIC__/image/close.gif") right 9px no-repeat}
        .select .select-result a:hover{background-position:right -15px}
        .tc{text-align:center; text-indent:0;font-family:"微软雅黑";font-size: 14px;color:#111;}
        .tel{left:0; top:10px; width:220px; height:26px; line-height:26px; color:#555; font-family:"微软雅黑"; repeat-x left top; border:solid 1px #ccc;}
        .sure{left:220px; top:10px; width:60px; height:28px; line-height:28px; border:none; background:#090; color:#fff; font-family:"微软雅黑"; cursor:pointer;}
        #str{position:absolute; margin-left:400px;}
    </style>
</head>
<body>
<div id="content">
    <h1>首页 > 财务管理 > 财务列表</h1>
    <h2>
        <div class="h2_left">
            <a href="__ACTION__" class="whole">全部</a>
            <a href="javascript:;" class="f5" onclick="f5();">刷新</a>
            <a href="javascript:history.back();" class="Retreat">后退</a>
            <a href="javascript:history.go(1);" class="Advance">前进</a>
        </div>
    </h2>
    <div class="fen">
        <ul class="select" style="height:135px;margin-top: 20px;margin-bottom: 20px;">
            <li class="select-list List_more">
                <dl id="select">
                    <dt>交易类型：</dt>
                    <dd <?php if(get('s') == ''){ echo 'class="selected select-all"';} $s = '';?>><a href="<{$s|createsearchurl="/Financial/reco",s,###,"add",null,null}>">全部</a></dd>
                    <volist name="recjtype" id="val">
                        <dd <if condition="$Think.get.s eq $val['value']"> class="selected select-all"</if>><a href="<{$val.value|createsearchurl="/Financial/reco",s,###,"add",null,null}>"><{$val.name}></a></dd>
                    </volist>
                </dl>
            </li>
            <li class="select-list List_more">
                <dl id="select">
                    <dt>交易状态：</dt>
                    <dd <?php if(get('t') == ''){ echo ' class="selected select-all"';}$t = '';?>><a href="<{$t|createsearchurl="/Financial/reco",t,###,"add",null,null}>">全部</a></dd>
                    <volist name="recstatus" id="val">
                        <dd <if condition="$Think.get.t eq $val['value']"> class="selected select-all"</if>><a href="<{$val.value|createsearchurl="/Financial/reco",t,###,"add",null,null}>"><{$val.name}></a></dd>
                    </volist>
                </dl>
            </li>
            <li class="select-list List_more">
                <dl id="select">
                    <dt>支付类型：</dt>
                    <dd <?php if(get('p')==''){ echo ' class="selected select-all"';}$p = '';?>><a href="<{$p|createsearchurl="/Financial/reco",p,###,"add",null,null}>">全部</a></dd>
                    <volist name="recztype" id="val">
                        <dd <if condition="$Think.get.p eq $val['value']"> class="selected select-all"</if>><a href="<{$val.value|createsearchurl="/Financial/reco",p,###,"add",null,null}>"><{$val.name}></a></dd>
                    </volist>
                </dl>
            </li>
        </ul>
    </div>

    <form method="get">
    <div>
        <div>
            手机号:
            <input type="text"  name="tel" class="tel telephone" value="<{$tel}>"/>&nbsp;&nbsp;&nbsp;&nbsp;
            昵称:
            <input type="text"  name="username" class="tel userName" value="<{$name}>"/>&nbsp;&nbsp;&nbsp;&nbsp;
            交易号:
            <input type="text"  name="payno" class="tel payno" value="<{$payno}>"/>&nbsp;&nbsp;&nbsp;&nbsp;
            订单号:
            <input type="text" name="orderno" class="tel orderno" value="<{$orderno}>"/>&nbsp;&nbsp;&nbsp;&nbsp;
            公司名称:
            <input type="text" name="userCompany" class="tel userCompany" value="<{$userCompany}>"/>&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="submit" class="sure" value="搜索" />&nbsp;&nbsp;&nbsp;&nbsp;
            <button id="exportButton" type="button" style="background:#090; color:#fff;font-size: 13px;padding-top: 5px;padding-bottom: 6px;padding-left: 15px;padding-right: 15px;cursor: pointer;">导出</button>
        </div>

        <div class="date" style="margin-top: 10px;">
            交易开始时间:
            <input name="sBeginTime" type="text" id="start_date" name="start_date" value="<{$tradeTimeStart}>" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'2012-01-01',maxDate:&quot;#F{$dp.$D('end_date')||'2038-01-01'}&quot;})" class="Wdate sBeginTime"/>&nbsp;~
            <input name="sEndTime" type="text" id="end_date" value="<{$tradeTimeEnd}>" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss', minDate:&quot;#F{$dp.$D(\'start_date\')}&quot;,maxDate:'2038-01-01'})" name="end_date" class="Wdate sEndTime"/>

            交易结束时间:
            <input name="EBeginTime" type="text" id="start_date" name="start_date" value="<{$tradeFinishTimeStart}>" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'2012-01-01',maxDate:&quot;#F{$dp.$D('end_date')||'2038-01-01'}&quot;})" class="Wdate EBeginTime"/>&nbsp;~
            <input name="eEndTime" type="text" id="end_date" value="<{$tradeFinishTimeEnd}>" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss', minDate:&quot;#F{$dp.$D(\'start_date\')}&quot;,maxDate:'2038-01-01'})" name="end_date" class="Wdate eEndTime"/>
        </div>
    </div>
    </form>

    <div id="str"></div>
    <table id="table" border="1" bordercolor="#CCCCCC" cellpadding="0" cellspacing="0">
        <tr>
            <th>交易号</th>
            <th>订单号</th>
            <th>微信/支付宝流水号</th>
            <th>交易开始时间</th>
            <th>昵称</th>
            <th>真实姓名</th>
            <th>公司名称</th>
            <th>手机号</th>
            <th>备注</th>
            <th>金额</th>
            <th>交易结束时间</th>
            <th>用户支出/支入</th>
            <th>交易类型</th>
            <th>交易状态</th>
            <th>支付类型</th>
        </tr>
       <if condition="count($reco)">
        <volist name="reco" id="vo">
            <tr>
                <td style="text-align:center" class='tc'><{$vo.mainTradeNo}></td>
                <td style="text-align:center" class='tc'><{$vo.orderNo}></td>
                <td style="text-align:center" class='tc'><{$vo.thirdTradeNo}></td>
                <td style="text-align:center" class='tc'><{$vo.tradeTime}></td>
                <td style="text-align:center" class='tc'><{$vo.userNickName}></td>
                <td style="text-align: center" class='tc'><{$vo.userRealName}></td>
                <td style="text-align: center" class='tc'><{$vo.userCompany}></td>
                <td style="text-align: center" class='tc'><{$vo.userTelephone}></td>
                <td style="text-align: center" class='tc'><{$vo.title|mbsubstr=0,20}></td>

                    
                <td style="text-align: center" class='tc'>
                   
                    <switch name="vo.tradeType">
                        <case value="0">-<{$vo.money}></case>
                        <case value="1">-<{$vo.money}></case>
                        <case value="2"><{$vo.money}></case>
                        <case value="3">-<{$vo.money}></case>
                        <case value="4"><{$vo.money}></case>
                        <case value="5"><{$vo.money}></case>
                        <default />
                    </switch>

                </td>


                <td style="text-align: center" class='tc'><{$vo.tradeFinishTime}></td>
                
                <td style="text-align:center" class='tc'>
                    <!-- 使用switch标签判断输出 -->
                    <switch name="vo.tradeType">
                        <case value="0">支出</case>
                        <case value="1">支出</case>
                        <case value="2">支入</case>
                        <case value="3">支出</case>
                        <case value="4">支入</case>
                        <case value="5">支入</case>
                        <default />
                    </switch>
                </td>

                <td style="text-align:center" class='tc'>
                    <!-- 使用switch标签判断输出 -->
                    <switch name="vo.tradeType">
                        <case value="0">提现</case>
                        <case value="1">逸管家自营服务</case>
                        <case value="2">在线收款</case>
                        <case value="3">在线支付</case>
                        <case value="4">发起在线退款</case>
                        <case value="5">充值</case>
                        <default />
                    </switch>
                </td>
                <td style="text-align:center" class='tc'>
                    <!-- 使用switch标签判断输出 -->
                    <switch name="vo.tradeStatus">
                        <case value="0">失败</case>
                        <case value="1">待付款</case>
                        <case value="2">成功</case>
                        <case value="3">待收款</case>
                        <default />
                    </switch>
                </td>
                <td style="text-align:center" class='tc'>
                    <!-- 使用switch标签判断输出 -->
                    <switch name="vo.payType">
                        <case value="0">支付宝</case>
                        <case value="1">微信</case>
                        <case value="2">余额支付</case>
                        <case value="3">银行卡</case>
                        <case value="4">线下付款</case>
                        <default />
                    </switch>
                </td>
            </tr>
        </volist>
      <else />
        <tr><td style="text-align:center" colspan="15" class='tc'>当前请求无数据</td></tr>
  </if>
    </table>
    <div id="page">
        <{$page}>
    </div>
</div>
<form id="searchAndExportForm" action="<{$Think.config.url}>/manager/tradeRecord/exportNew" method="post">
    <input type='hidden' name="tradeType" value="<{$tradeTypeNew}>" id="tradeTypeHidden" />
    <input type='hidden' name="tradeStatus" value="<{$tradeStatusNew}>" id="tradeStatusHidden" />
    <input type='hidden' name="payType" value="<{$payTypeNew}>" id="payTypeHidden" />
    <input type='hidden' name="tel" id="telHidden" />
    <input type='hidden' name="userName" id="userNameHidden" />
    <input type='hidden' name="mainTradeNo" value="" id="mainTradeNoHidden" />
    <input type='hidden' name="orderNo" id="orderNoHidden" />
    <input type='hidden' name="userCompany" id="userCompanyHidden" />
    <input type='hidden' name="tradeTimeStart" id="tradeTimeStartHidden" />
    <input type='hidden' name="tradeTimeEnd" id="tradeTimeEndHidden" />
    <input type='hidden' name="tradeFinishTimeStart" id="tradeFinishTimeStartHidden" />
    <input type='hidden' name="tradeFinishTimeEnd" id="tradeFinishTimeEndHidden" />
</form>>
<script>
$('#exportButton').click(function(){
    if(!($(this).attr('disabled'))){        
        $(this).attr('disabled',true);
        $(this).css("background",'#ddd');
        var _data={};
        _data.tradeType = $("#tradeTypeHidden").val();
        _data.tradeStatus = $("#tradeStatusHidden").val();
        _data.payType = $("#payTypeHidden").val();
        $("#telHidden").val($.trim($('input[name=tel]').val()));
        _data.tel = $("#telHidden").val();
        $("#userNameHidden").val($.trim($('input[name=username]').val()));
        _data.userName = $("#userNameHidden").val();
        $("#mainTradeNoHidden").val($.trim($('input[name=payno]').val()));
        _data.mainTradeNo = $("#mainTradeNoHidden").val();
        $("#orderNoHidden").val($.trim($('input[name=orderno]').val()));
        _data.orderNo = $("#orderNoHidden").val();
        $("#userCompanyHidden").val($.trim($('input[name=userCompany]').val()));
        _data.userCompany = $("#userCompanyHidden").val();
        $("#tradeTimeStartHidden").val($.trim($('input[name=sBeginTime]').val()));
        _data.tradeTimeStart = $("#tradeTimeStartHidden").val();
        $("#tradeTimeEndHidden").val($.trim($('input[name=sEndTime]').val()));
        _data.tradeTimeEnd = $("#tradeTimeEndHidden").val();
        $("#tradeFinishTimeStartHidden").val($.trim($('input[name=EBeginTime]').val()));
        _data.tradeFinishTimeStart = $("#tradeFinishTimeStartHidden").val();
        $("#tradeFinishTimeEndHidden").val($.trim($('input[name=eEndTime]').val()));
        _data.tradeFinishTimeEnd = $("#tradeFinishTimeEndHidden").val();

        $.post("<{$Think.config.url}>/manager/tradeRecord/exportCount",_data,function(res){                
            if(res.data.count > 0){                  
                $("#searchAndExportForm").submit();
                $('#exportButton').css("background",'#090');
                $('#exportButton').removeAttr("disabled");
            }else{
                alert('暂无数据可下载！');
                f5();
            }            
        },'json')
        
    }
})  
// $('#exportButton').click(function(){
//     if(!($(this).attr('disabled'))){        
//         $(this).attr('disabled',true);
//         $(this).css("background",'#ddd');
//         $.get("<{:U('Financial/export')}>",'',function(res){                
//             $('#exportButton').css("background",'#090');
//             $('#exportButton').removeAttr("disabled");
//             if(res.code){
//                 window.location.href = "<{:U('Financial/downExcel')}>?path="+res.data;  
//             }else{
//                 alert(res.msg);
//             }
            
//         },'json')
//     }
// })   
</script>
</body>
</html>
